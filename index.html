<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clicker Game</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
        }

        .container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .block {
            border: 1px solid #ccc;
            padding: 20px;
            width: 45%;
        }

        .block h2 {
            margin-top: 0;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        .red-text {
            color: red;
            font-weight: bold;
        }

        .counters {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .counters-column {
            text-align: left;
        }

        #timer {
            font-weight: bold;
            margin-bottom: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .header img {
            width: 320px;
            height: 200px;
            margin-right: 80px;
        }

        .collaborateur-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .save-load {
            margin-top: 20px;
        }

        /* Ajoutez ce style pour le bouton reset */
        .reset-button {
            background-color: #ff4444;
            color: white;
            margin-left: 10px;
        }

        /* Ajoutez ces styles */
        .counter-with-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .counter-icon {
            width: 40px;
            height: 40px;
            vertical-align: middle;
        }

        .main-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            gap: 20px;
        }

        .game-content {
            flex: 1;
        }

        .charges-history {
            width: 50px;
            padding: 10px;
            background-color: #f5f5f5;
            border-left: 1px solid #ccc;
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            overflow-y: auto;
        }

        .charges-history h3 {
            margin-top: 0;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .charge-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        /* Style pour l'animation du symbole $ */
        @keyframes popAndFade {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-20px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-40px) scale(1);
            }
        }

        .money-symbol {
            position: absolute;
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.2em;
            animation: popAndFade 1s ease-out forwards;
            pointer-events: none;
        }

        .counter-with-icon {
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
        }
    </style>
</head>

<body>
    <div class="header">
        <img src="artworks-Trz3ur7AMmcm4IJz-2hoNzg-t500x500.jpg" alt="Logo du jeu">
        <h1>Mao Zedong tycoon $$$ 开儿 艾迪开伊 艾艾 西吉艾艾伊奈伊 </h1>
    </div>

    <p id="timer">Temps restant avant les charges: 3:00</p>

    <div class="counters">
        <div class="counters-column">
            <div class="counter-with-icon">
                <p id="colis_temu_counter">Colis Temu: 0</p>
                <img src="colis_temu.png" alt="Colis Temu" class="counter-icon">
            </div>
            <div class="counter-with-icon">
                <p id="thunescounter">thune(s): 0</p>
                <img src="Thune.png" alt="Thune" class="counter-icon">
            </div>
        </div>
        <div class="counters-column">
            <p id="collaborateurs">Collaborateur(s): 0/0</p>
            <p id="charges">Charges: 0 thunes</p>
        </div>
    </div>

    <p>Limite de faillite: <span id="limite_faillite" class="red-text">0</span></p>

    <button id="clic_button">+1 Colis Temu</button>
    <button id="achat_collaborateur" disabled>Embaucher un collaborateur: 100 thunes</button>

    <div class="container">
        <div class="block" id="fabrication_block">
            <h2>Fabrication</h2>
            <p id="fabrication">Fabrication: 0 collaborateurs (0 Colis Temu/sec)</p>
            <button id="acheter_temu_factory" disabled>Acheter une Temu factory: 60 thunes</button>
            <div class="collaborateur-buttons">
                <button id="ajouter_fabrication" disabled>Ajouter collaborateur</button>
                <button id="retirer_fabrication" disabled>Retirer collaborateur</button>
            </div>
        </div>

        <div class="block" id="envoi_block">
            <h2>Envoi</h2>
            <p id="centre_envoi">Centre d'envoi: 0 Colis Temu/sec</p>
            <button id="envoyer_manuel">Envoyer 1 colis manuellement</button>
            <div class="collaborateur-buttons">
                <button id="ajouter_envoi" disabled>Ajouter collaborateur</button>
                <button id="retirer_envoi" disabled>Retirer collaborateur</button>
            </div>
        </div>
    </div>

    <div class="save-load">
        <button id="save-game">Sauvegarder la partie</button>
        <button id="load-game">Charger une sauvegarde</button>
        <button id="reset-game" class="reset-button">Réinitialiser la partie</button>
        <input type="file" id="load-file" style="display: none;" accept=".json">
    </div>

    <div class="main-container">
        <div class="game-content">
            <div class="charges-history">
                <h3>Historique des charges</h3>
                <div id="charges-list"></div>
            </div>
        </div>

        <div class="charges-history">
            <h3>Historique des charges</h3>
            <div id="charges-list"></div>
        </div>
    </div>

    <script>
        let colisTemu = 0;
        let thune = 0;
        let autocliqueur = false;
        let collaborateurs = 0;
        let collaborateur_price = 125;
        const collaborateur_price_range = { min: 100, max: 150 };
        let collaborateursFabrication = 0;
        let collaborateursEnvoi = 0;
        let collaborateurs_max = 0;
        let collaborateursNonPlaces = 0;
        let earnedSinceLastCharge = 0;
        let limiteFaillite = 0;
        let multiplicateurLimite = 1;
        let timeLeft = 180; // 3 minutes en secondes
        const prixParColis = 2; // Prix fixe par colis envoyé
        let currentCharges = 0;
        let temuFactories = 0;
        const temuFactoryPrice = 60;
        let temuFactoryAchetee = false;

        const clicbutton = document.getElementById('clic_button');
        const colisTemuCounter = document.getElementById('colis_temu_counter');
        const thunescounter = document.getElementById('thunescounter');
        const acheterTemuFactory = document.getElementById('acheter_temu_factory');
        const achatcollaborateur = document.getElementById('achat_collaborateur');
        const limiteFailliteElement = document.getElementById('limite_faillite');
        const collaborateursElement = document.getElementById('collaborateurs');
        const fabricationElement = document.getElementById('fabrication');
        const centreEnvoiElement = document.getElementById('centre_envoi');
        const envoyerManuelButton = document.getElementById('envoyer_manuel');
        const ajouterFabricationButton = document.getElementById('ajouter_fabrication');
        const retirerFabricationButton = document.getElementById('retirer_fabrication');
        const ajouterEnvoiButton = document.getElementById('ajouter_envoi');
        const retirerEnvoiButton = document.getElementById('retirer_envoi');
        const timerElement = document.getElementById('timer');
        const chargesElement = document.getElementById('charges');

        let autoclickInterval;
        let envoiInterval;

        // Ajoutez cette variable pour stocker l'historique des charges
        let chargesHistory = [];
        let currentMonth = 1;

        function updateUI() {
            colisTemuCounter.textContent = `Colis Temu: ${colisTemu}`;
            thunescounter.textContent = `thune(s): ${thune}`;
            collaborateursElement.textContent = `Collaborateur(s): ${collaborateursNonPlaces}/${collaborateurs_max} (non placés)`;
            fabricationElement.textContent = `Fabrication: ${collaborateursFabrication} collaborateurs (${collaborateursFabrication} Colis Temu/sec)`;
            centreEnvoiElement.textContent = `Centre d'envoi: ${collaborateursEnvoi} collaborateurs (${collaborateursEnvoi} Colis Temu/sec)`;
            achatcollaborateur.disabled = thune < collaborateur_price || collaborateursNonPlaces >= collaborateurs_max;
            achatcollaborateur.textContent = `Embaucher un collaborateur: ${Math.floor(collaborateur_price)} thunes`;
            acheterTemuFactory.disabled = thune < temuFactoryPrice || temuFactoryAchetee;
            ajouterFabricationButton.disabled = collaborateursNonPlaces === 0;
            retirerFabricationButton.disabled = collaborateursFabrication === 0;
            ajouterEnvoiButton.disabled = collaborateursNonPlaces === 0;
            retirerEnvoiButton.disabled = collaborateursEnvoi === 0;
            chargesElement.textContent = `Charges: ${currentCharges} thunes`;
        }

        clicbutton.addEventListener('click', () => {
            colisTemu += 1; // Uniquement +1 pour les clics manuels
            updateUI();
        });

        achatcollaborateur.addEventListener('click', () => {
            if (thune >= collaborateur_price && collaborateursNonPlaces < collaborateurs_max) {
                thune -= collaborateur_price;
                collaborateurs++;
                collaborateursNonPlaces++;
                updateUI();
            }
        });

        acheterTemuFactory.addEventListener('click', () => {
            if (thune >= temuFactoryPrice && !temuFactoryAchetee) {
                thune -= temuFactoryPrice;
                temuFactories++;
                collaborateurs_max += 10; // Chaque usine Temu permet d'avoir 10 collaborateurs supplémentaires
                startAutoColisGeneration();
                temuFactoryAchetee = true;
                updateUI();
            }
        });

        function startAutoColisGeneration() {
            if (autoclickInterval) {
                clearInterval(autoclickInterval);
            }
            if (collaborateursFabrication > 0) {
                autoclickInterval = setInterval(() => {
                    colisTemu += collaborateursFabrication; // Production automatique basée sur les collaborateurs
                    updateUI();
                }, 1000);
            }
        }

        function startAutoEnvoi() {
            if (envoiInterval) {
                clearInterval(envoiInterval);
            }
            if (collaborateursEnvoi > 0) {
                envoiInterval = setInterval(() => {
                    if (colisTemu > 0) {
                        let colisEnvoyes = Math.min(collaborateursEnvoi, colisTemu);
                        colisTemu -= colisEnvoyes;
                        thune += colisEnvoyes * prixParColis;
                        earnedSinceLastCharge += colisEnvoyes * prixParColis;
                        updateUI();
                    }
                }, 1000);
            }
        }

        ajouterFabricationButton.addEventListener('click', () => {
            if (collaborateursNonPlaces > 0) {
                collaborateursNonPlaces--;
                collaborateursFabrication++;
                startAutoColisGeneration(); // Démarrer la production automatique
                updateUI();
            }
        });

        retirerFabricationButton.addEventListener('click', () => {
            if (collaborateursFabrication > 0) {
                collaborateursFabrication--;
                collaborateursNonPlaces++;
                startAutoColisGeneration(); // Redémarrer avec le nouveau nombre
                updateUI();
            }
        });

        ajouterEnvoiButton.addEventListener('click', () => {
            if (collaborateursNonPlaces > 0) {
                collaborateursNonPlaces--;
                collaborateursEnvoi++;
                startAutoEnvoi();
                updateUI();
            }
        });

        retirerEnvoiButton.addEventListener('click', () => {
            if (collaborateursEnvoi > 0) {
                collaborateursEnvoi--;
                collaborateursNonPlaces++;
                startAutoEnvoi();
                updateUI();
            }
        });

        envoyerManuelButton.addEventListener('click', () => {
            if (colisTemu > 0) {
                colisTemu--;
                thune += prixParColis;
                earnedSinceLastCharge += prixParColis;
                updateUI();
            }
        });

        function updateTimer() {
            timeLeft--;
            if (timeLeft <= 0) {
                applyCharges();
            }
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            timerElement.textContent = `Temps restant avant les charges: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function applyCharges() {
            let baseCharges = Math.floor(earnedSinceLastCharge * 0.2);
            let employeCharges = collaborateurs * 6;
            currentCharges = baseCharges + employeCharges;

            // Ajouter les charges à l'historique
            chargesHistory.push({
                month: currentMonth,
                amount: currentCharges
            });
            currentMonth++;

            // Mettre à jour l'affichage de l'historique
            updateChargesHistory();

            thune -= currentCharges;
            earnedSinceLastCharge = 0;
            timeLeft = 180;
            limiteFaillite = currentCharges * multiplicateurLimite;
            multiplicateurLimite *= 1.05;
            updateUI();
            checkBankruptcy();
        }

        function checkBankruptcy() {
            if (thune < -limiteFaillite) {
                alert("Vous êtes en faillite ! Le jeu va recommencer.");
                resetGame();
            }
        }

        function resetGame() {
            console.log("Fonction resetGame appelée");
            // Demander confirmation avant de reset
            if (confirm("Êtes-vous sûr de vouloir réinitialiser la partie ? Tout progrès non sauvegardé sera perdu.")) {
                // Arrêter les intervalles existants
                if (autoclickInterval) {
                    clearInterval(autoclickInterval);
                    autoclickInterval = null;
                }
                if (envoiInterval) {
                    clearInterval(envoiInterval);
                    envoiInterval = null;
                }

                // Réinitialisation de toutes les variables
                colisTemu = 0;
                thune = 0;
                autocliqueur = false;
                collaborateurs = 0;
                collaborateur_price = 125;
                collaborateursFabrication = 0;
                collaborateursEnvoi = 0;
                temuFactories = 0;
                collaborateurs_max = 0;
                collaborateursNonPlaces = 0;
                earnedSinceLastCharge = 0;
                limiteFaillite = 0;
                multiplicateurLimite = 1;
                timeLeft = 180;
                currentCharges = 0;
                temuFactoryAchetee = false;
                chargesHistory = [];
                currentMonth = 1;

                // Réinitialiser le stockage local
                localStorage.removeItem('gameState');

                // Mettre à jour l'interface
                updateUI();
                updateChargesHistory();

                // Confirmer la réinitialisation
                alert("La partie a été réinitialisée avec succès !");
            }
        }

        setInterval(updateTimer, 1000);
        updateUI();

        const saveGameButton = document.getElementById('save-game');
        const loadGameButton = document.getElementById('load-game');
        const loadFileInput = document.getElementById('load-file');
        const resetGameButton = document.getElementById('reset-game');

        function saveGame() {
            const gameState = {
                colisTemu,
                thune,
                autocliqueur,
                collaborateurs,
                collaborateur_price,
                collaborateursFabrication,
                collaborateursEnvoi,
                temuFactories,
                collaborateurs_max,
                collaborateursNonPlaces,
                temuFactoryAchetee,  // Ajout de cette variable
                timeLeft,
                earnedSinceLastCharge,
                multiplicateurLimite,
                currentCharges,
                chargesHistory,
                currentMonth
            };

            // Sauvegarde dans le stockage local
            localStorage.setItem('gameState', JSON.stringify(gameState));

            // Création du fichier de sauvegarde à télécharger
            const blob = new Blob([JSON.stringify(gameState)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mao_zedong_tycoon_save.json';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);

            alert('Sauvegarde effectuée avec succès !');
        }

        function restoreGameState(gameState) {
            colisTemu = gameState.colisTemu;
            thune = gameState.thune;
            autocliqueur = gameState.autocliqueur;
            collaborateurs = gameState.collaborateurs;
            collaborateur_price = gameState.collaborateur_price;
            collaborateursFabrication = gameState.collaborateursFabrication;
            collaborateursEnvoi = gameState.collaborateursEnvoi;
            temuFactories = gameState.temuFactories;
            collaborateurs_max = gameState.collaborateurs_max;
            collaborateursNonPlaces = gameState.collaborateursNonPlaces;
            temuFactoryAchetee = gameState.temuFactoryAchetee;
            timeLeft = gameState.timeLeft;
            earnedSinceLastCharge = gameState.earnedSinceLastCharge;
            multiplicateurLimite = gameState.multiplicateurLimite;
            currentCharges = gameState.currentCharges;
            chargesHistory = gameState.chargesHistory || [];
            currentMonth = gameState.currentMonth || 1;

            // Redémarrer les systèmes automatiques
            if (collaborateursFabrication > 0) {
                startAutoColisGeneration();
            }
            if (collaborateursEnvoi > 0) {
                startAutoEnvoi();
            }

            updateUI();
            updateChargesHistory();
        }

        function loadGame(event) {
            if (event && event.target && event.target.files && event.target.files[0]) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const gameState = JSON.parse(e.target.result);
                            restoreGameState(gameState);
                            alert('Partie chargée avec succès !');
                        } catch (error) {
                            alert('Erreur lors du chargement de la sauvegarde.');
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                }
            } else {
                const savedState = localStorage.getItem('gameState');
                if (savedState) {
                    try {
                        const gameState = JSON.parse(savedState);
                        restoreGameState(gameState);
                    } catch (error) {
                        console.error('Erreur lors du chargement de la sauvegarde locale :', error);
                    }
                }
            }
        }

        saveGameButton.addEventListener('click', saveGame);
        loadGameButton.addEventListener('click', () => loadFileInput.click());
        loadFileInput.addEventListener('change', loadGame);
        resetGameButton.addEventListener('click', resetGame);

        // Charger automatiquement la dernière sauvegarde au démarrage du jeu
        window.addEventListener('load', () => {
            loadGame();
        });

        console.log("Bouton reset :", resetGameButton); // Devrait afficher l'élément bouton et non null

        // Ajoutez cette fonction pour mettre à jour l'affichage de l'historique
        function updateChargesHistory() {
            const chargesList = document.getElementById('charges-list');
            chargesList.innerHTML = '';
            
            chargesHistory.slice().reverse().forEach(charge => {
                const entry = document.createElement('div');
                entry.className = 'charge-entry';
                entry.textContent = `Mois ${charge.month}: ${Math.floor(charge.amount)} thunes`;
                chargesList.appendChild(entry);
            });
        }

        function createMoneyAnimation() {
            const thuneCounter = document.getElementById('thunescounter');
            const moneySymbol = document.createElement('span');
            moneySymbol.textContent = '$';
            moneySymbol.className = 'money-symbol';
            
            // Position aléatoire autour du compteur
            moneySymbol.style.left = `${Math.random() * 20 + 10}px`;
            moneySymbol.style.top = '0px';
            
            thuneCounter.parentElement.appendChild(moneySymbol);
            
            // Supprimer l'élément après l'animation
            setTimeout(() => {
                moneySymbol.remove();
            }, 1000);
        }

        // Modifier la fonction envoyerColis pour ajouter l'animation
        function envoyerColis(nombreColis) {
            let colisAEnvoyer = Math.min(colisTemu, nombreColis);
            if (colisAEnvoyer > 0) {
                colisTemu -= colisAEnvoyer;
                let gainThunes = colisAEnvoyer * prixParColis;
                thune += gainThunes;
                earnedSinceLastCharge += gainThunes;
                createMoneyAnimation(); // Ajouter l'animation
                updateUI();
            }
        }

        // Modifier startAutoEnvoi pour inclure l'animation
        function startAutoEnvoi() {
            if (envoiInterval) {
                clearInterval(envoiInterval);
            }
            if (collaborateursEnvoi > 0) {
                envoiInterval = setInterval(() => {
                    if (colisTemu > 0) {
                        let colisEnvoyes = Math.min(collaborateursEnvoi, colisTemu);
                        colisTemu -= colisEnvoyes;
                        let gainThunes = colisEnvoyes * prixParColis;
                        thune += gainThunes;
                        earnedSinceLastCharge += gainThunes;
                        createMoneyAnimation(); // Ajouter l'animation
                        updateUI();
                    }
                }, 1000);
            }
        }

        // Modifier le bouton d'envoi manuel pour inclure l'animation
        envoyerManuelButton.addEventListener('click', () => {
            if (colisTemu > 0) {
                colisTemu--;
                thune += prixParColis;
                earnedSinceLastCharge += prixParColis;
                createMoneyAnimation(); // Ajouter l'animation
                updateUI();
            }
        });
    </script>
</body>

</html>
