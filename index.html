<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=2.0">
    <title>Clicker Game</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
        }

        .container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .block {
            border: 1px solid #ccc;
            padding: 20px;
            width: 45%;
        }

        .block h2 {
            margin-top: 0;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        .red-text {
            color: red;
            font-weight: bold;
        }

        .counters {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .counters-column {
            text-align: left;
        }

        #timer {
            font-weight: bold;
            margin-bottom: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .header img {
            width: 320px;
            height: 200px;
            margin-right: 80px;
        }

        .collaborateur-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="header">
        <img src="artworks/artwork.jpg" alt="Logo du jeu">
        <h1>Mao Zedong tycoon $$$ 开儿 艾迪开伊 艾艾 西吉艾艾伊奈伊 </h1>
    </div>

    <div id="login-container">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Identifiant">
        <input type="password" id="password" placeholder="Mot de passe">
        <button id="login-button">Se connecter</button>
        <button id="register-button">Créer un compte</button>
        <p id="login-message"></p>
    </div>

    <div id="game-container" style="display:none;">
        <p id="timer">Temps restant avant les charges: 3:00</p>

        <div class="counters">
            <div class="counters-column">
                <p id="colis_temu_counter">Colis Temu: 0</p>
                <p id="thunescounter">thune(s): 0</p>
            </div>
            <div class="counters-column">
                <p id="collaborateurs">Collaborateur(s): 0/0</p>
                <p id="charges">Charges: 0 thunes</p>
            </div>
        </div>

        <p>Limite de faillite: <span id="limite_faillite" class="red-text">0</span></p>

        <button id="clic_button">+1 Colis Temu</button>
        <button id="achat_collaborateur" disabled>Embaucher un collaborateur: 100 thunes</button>

        <div class="container">
            <div class="block" id="fabrication_block">
                <h2>Fabrication</h2>
                <p id="fabrication">Fabrication: 0 collaborateurs (0 Colis Temu/sec)</p>
                <button id="acheter_temu_factory" disabled>Acheter une Temu factory: 60 thunes</button>
                <div class="collaborateur-buttons">
                    <button id="ajouter_fabrication" disabled>Ajouter collaborateur</button>
                    <button id="retirer_fabrication" disabled>Retirer collaborateur</button>
                </div>
            </div>

            <div class="block" id="envoi_block">
                <h2>Envoi</h2>
                <p id="centre_envoi">Centre d'envoi: 0 Colis Temu/sec</p>
                <button id="envoyer_manuel">Envoyer 1 colis manuellement</button>
                <div class="collaborateur-buttons">
                    <button id="ajouter_envoi" disabled>Ajouter collaborateur</button>
                    <button id="retirer_envoi" disabled>Retirer collaborateur</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const githubRepo = "ton_nom_d_utilisateur_github/ton_depot_github";
        const githubToken = "ton_jeton_github";
        const apiUrl = `https://api.github.com/repos/${githubRepo}/contents/users.json`;

        const loginButton = document.getElementById('login-button');
        const registerButton = document.getElementById('register-button');
        const loginMessage = document.getElementById('login-message');
        const loginContainer = document.getElementById('login-container');
        const gameContainer = document.getElementById('game-container');

        async function getUsersFromGitHub() {
            const response = await fetch(apiUrl, {
                headers: {
                    "Authorization": `token ${githubToken}`
                }
            });
            const data = await response.json();
            const content = atob(data.content);
            return JSON.parse(content);
        }

        async function updateUsersOnGitHub(users) {
            const getUsersResponse = await fetch(apiUrl, {
                headers: {
                    "Authorization": `token ${githubToken}`
                }
            });
            const getUsersData = await getUsersResponse.json();
            const sha = getUsersData.sha;

            const updatedContent = btoa(JSON.stringify(users));
            await fetch(apiUrl, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${githubToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: "Update user data",
                    content: updatedContent,
                    sha: sha
                })
            });
        }

        loginButton.addEventListener('click', async () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = await getUsersFromGitHub();
            if (username in users && users[username] === password) {
                loginMessage.textContent = 'Connexion réussie';
                loginContainer.style.display = 'none';
                gameContainer.style.display = 'block';
            } else {
                loginMessage.textContent = 'Identifiant ou mot de passe incorrect';
            }
        });

        registerButton.addEventListener('click', async () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = await getUsersFromGitHub();
            if (!(username in users)) {
                users[username] = password;
                await updateUsersOnGitHub(users);
                loginMessage.textContent = 'Compte créé avec succès, vous pouvez maintenant vous connecter';
            } else {
                loginMessage.textContent = 'Identifiant déjà existant';
            }
        });

        let colisTemu = 0;
        let thune = 0;
        let autocliqueur = false;
        let collaborateurs = 0;
        let collaborateur_price = 125;
        const collaborateur_price_range = { min: 100, max: 150 };
        let collaborateursFabrication = 0;
        let collaborateursEnvoi = 0;
        let collaborateurs_max = 0;
        let collaborateursNonPlaces = 0;
        let earnedSinceLastCharge = 0;
        let limiteFaillite = 0;
        let multiplicateurLimite = 1;
        let timeLeft = 180; // 3 minutes en secondes
        const prixParColis = 10; // Prix fixe par colis envoyé
        let currentCharges = 0;
        let temuFactories = 0;
        const temuFactoryPrice = 60;

        const clicbutton = document.getElementById('clic_button');
        const colisTemuCounter = document.getElementById('colis_temu_counter');
        const thunescounter = document.getElementById('thunescounter');
        const acheterTemuFactory = document.getElementById('acheter_temu_factory');
        const achatcollaborateur = document.getElementById('achat_collaborateur');
        const limiteFailliteElement = document.getElementById('limite_faillite');
        const collaborateursElement = document.getElementById('collaborateurs');
        const fabricationElement = document.getElementById('fabrication');
        const centreEnvoiElement = document.getElementById('centre_envoi');
        const envoyerManuelButton = document.getElementById('envoyer_manuel');
        const ajouterFabricationButton = document.getElementById('ajouter_fabrication');
        const retirerFabricationButton = document.getElementById('retirer_fabrication');
        const ajouterEnvoiButton = document.getElementById('ajouter_envoi');
        const retirerEnvoiButton = document.getElementById('retirer_envoi');
        const timerElement = document.getElementById('timer');
        const chargesElement = document.getElementById('charges');

        let autoclickInterval;
        let envoiInterval;

        function updateUI() {
            colisTemuCounter.textContent = `Colis Temu: ${colisTemu}`;
            thunescounter.textContent = `thune(s): ${thune}`;
            collaborateursElement.textContent = `Collaborateur(s): ${collaborateursNonPlaces}/${collaborateurs_max} (non placés)`;
            fabricationElement.textContent = `Fabrication: ${collaborateursFabrication} collaborateurs (${collaborateursFabrication * 2} Colis Temu/sec)`;
            centreEnvoiElement.textContent = `Centre d'envoi: ${collaborateursEnvoi} collaborateurs (${collaborateursEnvoi} Colis Temu/sec)`;
            achatcollaborateur.disabled = thune < collaborateur_price || collaborateurs >= collaborateurs_max;
            achatcollaborateur.textContent = `Embaucher un collaborateur: ${Math.floor(collaborateur_price)} thunes`;
            acheterTemuFactory.disabled = thune < temuFactoryPrice;
            acheterTemuFactory.textContent = `Acheter une Temu factory: ${temuFactoryPrice} thunes`;
            ajouterFabricationButton.disabled = collaborateursNonPlaces === 0;
            retirerFabricationButton.disabled = collaborateursFabrication === 0;
            ajouterEnvoiButton.disabled = collaborateursNonPlaces === 0;
            retirerEnvoiButton.disabled = collaborateursEnvoi === 0;
            chargesElement.textContent = `Charges: ${currentCharges} thunes`;
        }

        clicbutton.addEventListener('click', () => {
            colisTemu += 1 + (collaborateursFabrication * 2);
            updateUI();
        });

        achatcollaborateur.addEventListener('click', () => {
            if (thune >= collaborateur_price && collaborateurs < collaborateurs_max) {
                thune -= collaborateur_price;
                collaborateurs++;
                collaborateursNonPlaces++;
                updateUI();
            }
        });

        acheterTemuFactory.addEventListener('click', () => {
            if (thune >= temuFactoryPrice) {
                thune -= temuFactoryPrice;
                temuFactories++;
                collaborateurs_max += 10; // Chaque usine Temu permet d'avoir 10 collaborateurs supplémentaires
                startAutoColisGeneration();
                acheterTemuFactory.disabled = true; // Désactiver le bouton après l'achat
                updateUI();
            }
        });

        function startAutoColisGeneration() {
            if (!autocliqueur) {
                autocliqueur = true;
                autoclickInterval = setInterval(() => {
                    colisTemu += 1 + (collaborateursFabrication * 2);
                    updateUI();
                }, 1000); // Génère 1 colis + bonus par collaborateur chaque seconde
            }
        }

        function startAutoEnvoi() {
            if (envoiInterval) {
                clearInterval(envoiInterval);
            }
            if (collaborateursEnvoi > 0) {
                envoiInterval = setInterval(() => {
                    if (colisTemu > 0) {
                        let colisEnvoyes = Math.min(collaborateursEnvoi, colisTemu);
                        colisTemu -= colisEnvoyes;
                        thune += colisEnvoyes * prixParColis;
                        earnedSinceLastCharge += colisEnvoyes * prixParColis;
                        updateUI();
                    }
                }, 1000); // Chaque collaborateur envoie 1 colis par seconde
            }
        }

        ajouterFabricationButton.addEventListener('click', () => {
            if (collaborateursNonPlaces > 0) {
                collaborateursNonPlaces--;
                collaborateursFabrication++;
                updateUI();
            }
        });

        retirerFabricationButton.addEventListener('click', () => {
            if (collaborateursFabrication > 0) {
                collaborateursFabrication--;
                collaborateursNonPlaces++;
                updateUI();
            }
        });

        ajouterEnvoiButton.addEventListener('click', () => {
            if (collaborateursNonPlaces > 0) {
                collaborateursNonPlaces--;
                collaborateursEnvoi++;
                startAutoEnvoi();
                updateUI();
            }
        });

        retirerEnvoiButton.addEventListener('click', () => {
            if (collaborateursEnvoi > 0) {
                collaborateursEnvoi--;
                collaborateursNonPlaces++;
                startAutoEnvoi();
                updateUI();
            }
        });

        envoyerManuelButton.addEventListener('click', () => {
            if (colisTemu > 0) {
                colisTemu--;
                thune += prixParColis;
                earnedSinceLastCharge += prixParColis;
                updateUI();
            }
        });

        function updateTimer() {
            timeLeft--;
            if (timeLeft <= 0) {
                applyCharges();
            }
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            timerElement.textContent = `Temps restant avant les charges: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function applyCharges() {
            let baseCharges = Math.floor(earnedSinceLastCharge * 0.2);
            let employeCharges = collaborateurs * 6;
            currentCharges = baseCharges + employeCharges;
            thune -= currentCharges;
            earnedSinceLastCharge = 0;
            timeLeft = 180;
            limiteFaillite = currentCharges * multiplicateurLimite;
            multiplicateurLimite *= 1.05;
            updateUI();
            checkBankruptcy();
        }

        function checkBankruptcy() {
            if (thune < -limiteFaillite) {
                alert("Vous êtes en faillite ! Le jeu va recommencer.");
                resetGame();
            }
        }

        function resetGame() {
            colisTemu = 0;
            thune = 0;
            autocliqueur = false;
            collaborateurs = 0;
            earnedSinceLastCharge = 0;
            limiteFaillite = 0;
            multiplicateurLimite = 1;
            collaborateursFabrication = 0;
            collaborateursEnvoi = 0;
            collaborateursNonPlaces = 0;
            temuFactories = 0;
            collaborateurs_max = 0;
            clearInterval(autoclickInterval);
            clearInterval(envoiInterval);
            updateUI();
        }

        setInterval(updateTimer, 1000);
        updateUI();
    </script>
</body>

</html>
